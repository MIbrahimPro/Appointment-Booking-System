<link rel="stylesheet" href="/styles/change-password.css">


<div class="flex items-center justify-center min-h-screen">

    <div class="bg-white rounded-3xl shadow-lg p-8 m-4 w-full max-w-md sm:p-10 lg:p-12">
        <h1 class="text-3xl sm:text-4xl font-bold text-gray-800 text-center mb-2">Change Password</h1>
        <p class="heading-font text-gray-600 text-center mb-8 text-lg sm:text-xl">
            Update your account security
        </p>

        <form action="/client/user/change-password?_method=PUT" method="POST" class="space-y-6"
            onsubmit="return validateAndSubmit(event)">
            <div>
                <label for="current_password" class="block text-sm font-medium text-gray-700 mb-1">
                    Current Password
                </label>
                <div class="relative">
                    <input type="password" id="current_password" name="oldPassword" required
                        class="input-field w-full px-4 py-3 border border-gray-300 rounded-2xl text-gray-900 placeholder-gray-400
                 transition-all duration-200 ease-in-out focus:ring-2 focus:ring-blue-500 focus:border-transparent pr-10" placeholder="••••••••">
                    <span class="absolute inset-y-0 right-0 pr-3 flex items-center text-sm cursor-pointer">
                        <i id="toggleCurrentPassword" class="far fa-eye text-gray-500 hover:text-gray-700"></i>
                    </span>
                </div>
            </div>

            <div>
                <label for="new_password" class="block text-sm font-medium text-gray-700 mb-1">
                    New Password
                </label>
                <div class="relative">
                    <input type="password" id="new_password" name="newPassword" required
                        class="input-field w-full px-4 py-3 border border-gray-300 rounded-2xl text-gray-900 placeholder-gray-400
                 transition-all duration-200 ease-in-out focus:ring-2 focus:ring-blue-500 focus:border-transparent pr-10" placeholder="••••••••"
                        pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[!@#$%^&*()_+])[A-Za-z\\d!@#$%^&*()_+]{8,}$"
                        title="At least 8 chars, one uppercase, one lowercase, one number, one symbol">
                    <span class="absolute inset-y-0 right-0 pr-3 flex items-center text-sm cursor-pointer">
                        <i id="toggleNewPassword" class="far fa-eye text-gray-500 hover:text-gray-700"></i>
                    </span>
                </div>
            </div>

            <div>
                <label for="confirm_new_password" class="block text-sm font-medium text-gray-700 mb-1">
                    Confirm New Password
                </label>
                <div class="relative">
                    <input type="password" id="confirm_new_password" name="confirmPassword" required
                        class="input-field w-full px-4 py-3 border border-gray-300 rounded-2xl text-gray-900 placeholder-gray-400
                 transition-all duration-200 ease-in-out focus:ring-2 focus:ring-blue-500 focus:border-transparent pr-10" placeholder="••••••••">
                    <span class="absolute inset-y-0 right-0 pr-3 flex items-center text-sm cursor-pointer">
                        <i id="toggleConfirmNewPassword" class="far fa-eye text-gray-500 hover:text-gray-700"></i>
                    </span>
                </div>
            </div>

            <div class="flex justify-between space-x-4">
                <a href="/client/user/profile" class="flex-1 block text-center bg-gray-200 text-gray-700 py-3 rounded-2xl font-semibold
               hover:bg-gray-300 transition-colors duration-200 ease-in-out">
                    Cancel
                </a>
                <button type="submit" class="flex-1 bg-gray-800 text-white py-3 rounded-2xl font-semibold
               hover:bg-gray-700 transition-colors duration-200 ease-in-out">
                    Change Password
                </button>
            </div>
        </form>
    </div>

</div>

<script>
    // Flash popup utility
    function displayMessage(message, type = "info") {
        const msg = document.createElement('div');
        msg.className = `fixed top-5 left-1/2 -translate-x-1/2 p-4 rounded-lg text-white z-50
                     transition-all duration-300 transform scale-100 opacity-100`;
        msg.style.backgroundColor = type === 'error' ? '#EF4444' : '#3B82F6';
        msg.textContent = message;
        document.body.appendChild(msg);
        setTimeout(() => {
            msg.classList.replace('scale-100', 'scale-95');
            msg.classList.replace('opacity-100', 'opacity-0');
            msg.addEventListener('transitionend', () => msg.remove());
        }, 3000);
    }

    // Toggle eye icons
    function setupToggle(toggleId, inputId) {
        const t = document.getElementById(toggleId);
        const i = document.getElementById(inputId);
        t?.addEventListener('click', () => {
            i.type = i.type === 'password' ? 'text' : 'password';
            t.classList.toggle('fa-eye');
            t.classList.toggle('fa-eye-slash');
        });
    }
    setupToggle('toggleCurrentPassword', 'current_password');
    setupToggle('toggleNewPassword', 'new_password');
    setupToggle('toggleConfirmNewPassword', 'confirm_new_password');

    // Validate new vs confirm before submit
    function validateAndSubmit(e) {
        const newP = document.getElementById('new_password');
        const conf = document.getElementById('confirm_new_password');
        if (newP.value !== conf.value) {
            displayMessage("New password and confirmation do not match.", "error");
            return false;
        }
        if (!newP.checkValidity()) {
            displayMessage(newP.title, "error");
            return false;
        }
        return true; // let form submit
    }

    // On load, check query-string for error/msg
    window.addEventListener('DOMContentLoaded', () => {
        const params = new URLSearchParams(window.location.search);
        if (params.has('error')) {
            displayMessage(decodeURIComponent(params.get('error')), 'error');
        } else if (params.has('msg')) {
            displayMessage(decodeURIComponent(params.get('msg')), 'info');
        }
    });
</script>